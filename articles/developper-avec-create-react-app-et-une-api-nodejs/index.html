<!DOCTYPE html><html ><head><title data-react-helmet="true">Développer avec Create React App et une API Node.js | Putain de code</title><meta data-react-helmet="true" charset="UTF-8"/><meta data-react-helmet="true" name="description" value="Blog participatif de la communauté dev"/><meta data-react-helmet="true" content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport"/><meta data-react-helmet="true" content="summary_large_image" name="twitter:card"/><meta data-react-helmet="true" content="Putain de code !" property="og:site_name"/><meta data-react-helmet="true" content="@putaindecode" name="twitter:site"/><meta data-react-helmet="true" content="Putain de code" property="og:title"/><meta data-react-helmet="true" content="Putain de code" name="twitter:title"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" property="og:image"/><meta data-react-helmet="true" content="https://putaindecode.io/public/images/website/share.jpg" name="twitter:image"/><meta data-react-helmet="true" content="1500" property="og:image:width"/><meta data-react-helmet="true" content="777" property="og:image:height"/><link data-react-helmet="true" title="RSS Feed" href="/api/articles/feeds/desc/feed.xml" rel="alternate" type="application/rss+xml"/><link data-react-helmet="true" href="/public/favicon.ico" rel="shortcut icon"/><link data-react-helmet="true" href="https://putaindecode.io/articles/developper-avec-create-react-app-et-une-api-nodejs" rel="canonical"/><script data-react-helmet="true" >window.ga =
        window.ga ||
        function() {
          (ga.q = ga.q || []).push(arguments);
        };
      ga.l = +new Date();
      ga("create", "UA-43f771806-1", "auto");
      ga("send", "pageview");</script><script data-react-helmet="true" async="true" src="https://www.google-analytics.com/analytics.js"></script><script>window.PAGES_BOOT_MODE="hydrate";</script></head><div id="root"><style data-emotion-rpcss="cv6q29 cqg32g vfl2jy 94ols9 1nvx7co 1qdfdal">@-webkit-keyframes animation-cv6q29{0%{opacity:0;-webkit-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}@keyframes animation-cv6q29{0%{opacity:0;-webkit-transform:translateY(20px);-ms-transform:translateY(20px);transform:translateY(20px);}}body{padding:0;margin:0;background-color:#fff;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;min-height:100vh;overflow-x:hidden;}@media (prefers-color-scheme:dark){body{background-color:#222;}}#root{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}html{color:#46515B;font-size:1em;line-height:1.4;-webkit-font-smoothing:antialiased;-webkit-text-size-adjust:100%;}@media (prefers-color-scheme:dark){html{color:#ddd;}}a{color:#CC0613;-webkit-text-decoration:underline;text-decoration:underline;}@media (prefers-color-scheme:dark){a{color:#ddd;}}a:hover{-webkit-text-decoration:none;text-decoration:none;}*,*:before,*:after{box-sizing:border-box;}</style><style data-emotion-rpcss="u6xx5u">.rpcss-u6xx5u{background-color:#000;padding:10px;color:#fff;text-align:center;}</style><div class="rpcss-u6xx5u"><style data-emotion-rpcss="fyih5c">.rpcss-fyih5c{font-size:24px;font-weight:700;}</style><div class="rpcss-fyih5c" role="heading">Black Lives Matter</div><div><style data-emotion-rpcss="th8dfi">.rpcss-th8dfi{font-size:20px;color:#8CBEF9;}</style><a class="rpcss-th8dfi" href="https://blacklivesmatters.carrd.co/#">Comment aider</a> • <a class="rpcss-th8dfi" href="https://minnesotafreedomfund.org">Minnesota Freedom Fund</a> • <a class="rpcss-th8dfi" href="https://www.okpal.com/adama-traore/#/">Justice Pour Adama</a></div></div><style data-emotion-rpcss="1s4nnc7">.rpcss-1s4nnc7{background-color:#CC0613;background-image:linear-gradient(135deg,#E51D58 0%,#CC0613 100%);}</style><header class="rpcss-1s4nnc7" style="background-image:linear-gradient(to bottom right, hsl(257, 100%, 35%), hsl(213, 100%, 30%))"><style data-emotion-rpcss="qx7dny">.rpcss-qx7dny{width:100%;max-width:1024px;margin:0 auto;padding:0 10px;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:stretch;-webkit-box-align:stretch;-ms-flex-align:stretch;align-items:stretch;}</style><div class="rpcss-qx7dny"><style data-emotion-rpcss="7s9om2">.rpcss-7s9om2{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:20px 0 50px;}</style><div class="rpcss-7s9om2"><style data-emotion-rpcss="gdpa5c">.rpcss-gdpa5c{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;}</style><a class="rpcss-gdpa5c" href="/"><style data-emotion-rpcss="1lm4738">.rpcss-1lm4738{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-text-decoration:none;text-decoration:none;padding-bottom:10px;}</style><div class="rpcss-1lm4738"><style data-emotion-rpcss="13o7eu2">.rpcss-13o7eu2{display:block;}</style><svg class="rpcss-13o7eu2" height="36px" width="36px" viewBox="0 0 36 36"><defs><linearGradient id="PutainDeCodeLogoGradient" x1="50%" x2="50%" y1="0%" y2="127.223881%"><stop offset="0%" stop-color="#E41D57"></stop><stop offset="100%" stop-color="#C60000"></stop></linearGradient></defs><circle cx="18" cy="18" fill="url(#PutainDeCodeLogoGradient)" r="17" stroke="#FFFFFF" stroke-width="2"></circle><polygon fill="#FFFFFF" points="15.9033203 18.2246094 15.9033203 18.3710938 11.2304688 20.5317383 11.2304688 22.8095703 18.0566406 19.184082 18.0566406 17.4116211 11.2304688 13.7788086 11.2304688 16.0639648"></polygon><rect height="14" width="2" fill="#FFFFFF" x="22" y="11"><animate attributeName="opacity" begin="100ms" calcMode="discrete" dur="2s" repeatCount="indefinite" values="1;0"></animate></rect></svg><style data-emotion-rpcss="4cf197">.rpcss-4cf197{width:10px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-4cf197"></div><style data-emotion-rpcss="u5k24">.rpcss-u5k24{font-size:22px;color:#fff;font-weight:800;}</style><div aria-level="2" class="rpcss-u5k24" role="heading">Putain de code !</div></div><style data-emotion-rpcss="1nyebg4">.rpcss-1nyebg4{font-size:14px;color:rgba(255,255,255,0.8);text-align:center;}</style><div class="rpcss-1nyebg4">Blog participatif de la communauté dev</div></a></div></div></header><style data-emotion-rpcss="kcj2v3">.rpcss-kcj2v3{background-color:#F9F6F6;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;}@media (prefers-color-scheme:dark){.rpcss-kcj2v3{background-color:#111;}}</style><div class="rpcss-kcj2v3"><style data-emotion-rpcss="ees1g6">.rpcss-ees1g6{-webkit-animation:animation-cv6q29 500ms ease-out 0ms 1 normal none running;animation:animation-cv6q29 500ms ease-out 0ms 1 normal none running;}</style><div class="rpcss-ees1g6"><div class="rpcss-qx7dny"><style data-emotion-rpcss="1ktvb3t">.rpcss-1ktvb3t{font-size:42px;font-weight:800;text-align:center;padding-top:40px;line-height:1.2;}</style><div aria-level="1" class="rpcss-1ktvb3t" role="heading">Développer avec Create React App et une API Node.js</div><style data-emotion-rpcss="4ach9y">.rpcss-4ach9y{font-size:16px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding-top:10px;padding-bottom:40px;color:#46515B;-webkit-text-decoration:none;text-decoration:none;}@media (prefers-color-scheme:dark){.rpcss-4ach9y{color:#ccc;}}</style><a class="rpcss-4ach9y" href="https://github.com/tmaziere"><style data-emotion-rpcss="uco8i7">.rpcss-uco8i7{width:32px;height:32px;border-radius:100%;margin-right:10px;}</style><img class="rpcss-uco8i7" alt="tmaziere" src="https://avatars.githubusercontent.com/tmaziere?size=64"/><div>tmaziere<!-- --> <!-- -->•<!-- --> <time dateTime="Tue, 07 Nov 2017 00:00:00 GMT">2017/11/07</time></div></a><style data-emotion-rpcss="1ow2283">.rpcss-1ow2283{max-width:640px;width:100%;font-size:18px;margin:0 auto;line-height:1.7;}.rpcss-1ow2283 h2,.rpcss-1ow2283 h3,.rpcss-1ow2283 h4,.rpcss-1ow2283 h5,.rpcss-1ow2283 h6{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue",sans-serif;font-weight:800;line-height:1.2;}.rpcss-1ow2283 img{max-width:100%;background-color:rgba(255,255,255,0.75);}.rpcss-1ow2283 code{font-size:0.9em;font-family:PragmataPro,SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace;line-height:1;background-color:#FAF3E1;margin:0 0.2em;}@media (prefers-color-scheme:dark){.rpcss-1ow2283 code{background-color:#4F3804;}}.rpcss-1ow2283 pre{padding:10px;overflow-x:auto;font-size:14px;border-radius:10px;border:2px solid rgba(0,0,0,0.1);-webkit-overflow-scrolling:touch;}@media (prefers-color-scheme:dark){.rpcss-1ow2283 pre{border:2px solid rgba(255,255,255,0.1);}}.rpcss-1ow2283 pre code{font-size:14px;background-color:transparent;margin:0;}.rpcss-1ow2283 blockquote{padding-left:20px;margin:0;font-size:16px;border-left:3px solid rgba(0,0,0,0.4);font-style:italic;}.rpcss-1ow2283 .hljs-keyword{color:#DA6BB5;}.rpcss-1ow2283 .hljs-constructor{color:#DD792B;}.rpcss-1ow2283 .hljs-identifier{color:#1E9EA7;}.rpcss-1ow2283 .hljs-module-identifier{color:#C84682;}.rpcss-1ow2283 .hljs-string{color:#3BA1C8;}.rpcss-1ow2283 .hljs-comment{color:#aaa;}.rpcss-1ow2283 .hljs-operator{color:#DA6BB5;}.rpcss-1ow2283 .hljs-attribute{color:#4CB877;}.rpcss-1ow2283 table{width:100%;text-align:center;}.rpcss-1ow2283 figure{padding:20px 0;}.rpcss-1ow2283 figcaption{text-align:center;}.rpcss-1ow2283 a{overflow-wrap:break-word;}.rpcss-1ow2283 table thead th{background-color:#E4EBEE;padding:10px 0;}</style><div class="rpcss-1ow2283"><h2>tl;dr</h2>
<p>Dans un environnement de développement, pour lancer dans le même temps votre
application React et une API basée sur Node.js, vous pouvez imbriquer
judicieusement les deux dépôts Git, puis utiliser un script NPM et quelques
packages bien pratiques tels que <em>concurrently</em> et <em>nodemon</em> pour lancer les
deux serveurs d'une seule commande. Pratique ! D'autant que pour contourner les
restrictions d'accès liées à la
<a href="https://fr.wikipedia.org/wiki/Same-origin_policy"><em>politique de même origine</em></a>,
<strong>create-react-app</strong> permet le paramétrage d'un <em>proxy</em> pour vos requêtes API.</p>
<h2>Est-ce que ça me concerne ?</h2>
<p>La généralisation des architectures dites &quot;API first&quot; répond à des impératifs
humains et techniques très divers. En ce qui concerne l'organisation du travail
des développeurs, c'est l'assurance de pouvoir scinder l'implémentation de
l'accès aux données -aux ressources- d'une part, et le travail sur l'UI/UX,
d'autre part. Un premier groupe peut concevoir une API robuste et proposer un
&quot;contrat&quot; clair à l'équipe <em>frontend</em> qui accède aux données avec un référentiel
unique, que l'application soit web ou mobile.</p>
<p>De cette façon, la conception de l'interface utilisateur est libérée d'une
grande partie des contraintes qui régissent les architectures MVC
traditionnelles. Le développeur peut ainsi mieux se concentrer sur la qualité de
sa réponse aux spécifications fonctionnelles.</p>
<p>Si l'architecture de votre projet est de ce type, et que vous attaquez la
conception d'un frontend
<a href="https://fr.wikipedia.org/wiki/Application_web_monopage">SPA</a> React avec
<a href="https://github.com/facebookincubator/create-react-app">create-react-app</a>
(quelle bonne idée !), ce qui suit peut vous éclairer. Nous allons voir comment
il est possible d'accéder sans se compliquer la vie à une API RESTful basée sur
Node.js, en imbriquant correctement ses dépôts.</p>
<h2>Deux dépôts : le frontend, l’API</h2>
<p>Le principe est le suivant : vous ne souhaitez pas forcément modifier l'API qui
est implémentée par une autre équipe, ou par un collègue, mais vous devez y
accéder facilement depuis votre application React.</p>
<p>Vous allez pour cela devoir travailler sur deux dépôts Git clonés : celui du
<em>frontend</em> React contiendra par exemple celui de l'API, et un <em>script NPM</em> se
chargera de lancer les deux applications, sur deux ports différents.</p>
<p><em>Faut-il utiliser un framework en particulier pour le backend ?</em>  <br />
Absolument pas ! Pour ma part je travaille plus volontiers avec <a href="https://loopback.io/">LoopBack</a>,
mais tout ce que qui s'appuie sur Node.js fait l'affaire.</p>
<h2>Organisation locale du code</h2>
<p>Mettons que votre projet React s'appelle <strong>my-react-frontend</strong> et que l'API
qu'il consomme répond au doux nom de <strong>my-node-api</strong>.</p>
<p><strong>my-react-frontend</strong> est cloné à la racine, c'est le projet parent. Il contient
au moins les répertoires <code>src/</code>, <code>public/</code> et <code>node_modules/</code> générés par
<em>create-react-app</em>.</p>
<p><code>build/</code> peut également être présent si vous avez déjà lancé au moins une fois
la commande <code>npm run build</code>.</p>
<p>A la racine de <strong>my-react-frontend</strong>, clonez le dépôt <strong>my-node-api</strong>.</p>
<p>Vous devez obtenir :</p>
<pre><code>my-react-frontend/
-- my-node-api/
-- node_modules/
-- public/
-- src/
...
</code></pre>
<p>Ne nous attardons pas trop sur <code>my-node-api</code>, qui peut être implémenté de très
nombreuses manières. Partons du principe qu'une fois lancé, le serveur expose
les ressources dont votre application a besoin sur <code>http://localhost:3001</code>. Et
disons juste que si l'équipe <em>backend</em> vous signale une mise à jour, vous ferez
simplement :</p>
<pre><code class="language-Shell">cd my-node-api/
git pull
</code></pre>
<p><em>Faut-il forcément organiser les dépôts de cette façon ?</em>  <br />
Pas du tout. Mais l'intérêt de cette configuration, c'est que le <em>backend</em> est &quot;dans
sa bulle&quot; et que les développeurs qui le font évoluer n'ont pas à organiser le code
en fonction de ce <em>frontend</em> en particulier.</p>
<p>Dernière chose importante : pensez à ajouter <code>my-node-api/</code> au fichier
<code>.gitignore</code> du projet React. Il ne faudrait évidemment pas qu'il versionne le
<em>backend</em>.</p>
<h2>Passez moi sur le CORS</h2>
<p>En production, il est fréquent d'utiliser le même serveur pour servir
l'application React et l'API sous-jacente. Dans cette configuration, le
mécanisme de <em>Cross-origin resource sharing</em>
(<a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>), basé sur
des headers HTTP, n'a pas à être implémenté.</p>
<p>En développement, par contre, il est plus pratique de dissocier les serveurs
pour bénéficier de toutes les fonctionnalités de l'écosystème React.</p>
<p>Pour répondre à cette contrainte, <em>create-react-app</em> propose
<a href="https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#proxying-api-requests-in-development">un mécanisme</a>
qui permet de mettre en place un <strong>proxy</strong> d'API.</p>
<p>En partant du principe que votre frontend écoute sur le port 3000, et le serveur
API sur le port 3001, il suffit d'ajouter un paramètre au premier niveau du
<code>package.json</code> :</p>
<pre><code class="language-json">{
  <span class="hljs-attr">&quot;proxy&quot;</span>: <span class="hljs-string">&quot;http://localhost:3001&quot;</span>
}
</code></pre>
<p>De cette façon, vous pourrez utiliser un chemin relatif pour accéder à vos
ressources. Si une requête ne concerne pas un <em>asset</em> statique, elle sera
relayée vers votre <em>backend</em>. <code>fetch('/api/bananas')</code>, par exemple, requêtera
notre API sur <code>http://localhost:3001/api/bananas</code>.</p>
<h2>Tout lancer en une seule commande</h2>
<p>Nous utiliserons pour cela un script NPM défini dans le <code>package.json</code> situé à
la racine du projet React.</p>
<p>Deux petits outils seront nécessaires pour créer le script <em>ad hoc</em> :</p>
<ul>
<li>le package <a href="https://www.npmjs.com/package/concurrently"><code>concurrently</code></a> qui
permet de lancer plusieurs scripts en une seule commande. Faites par exemple
un <code>npm install --save-dev concurrently</code>.</li>
<li>le package <a href="https://www.npmjs.com/package/nodemon"><code>nodemon</code></a> qui scrute votre
<em>backend</em> Node.js et relance le serveur automatiquement en cas de modification
du code. Faites donc un <code>npm install --save-dev nodemon</code>, vous ne le
regretterez pas.</li>
</ul>
<p>Tout est prêt ! Ouvrez <code>package.json</code> et ajoutez dans les <code>scripts</code>:</p>
<pre><code class="language-json">&quot;start-with-api&quot;: &quot;concurrently \&quot;react-scripts start\&quot; \&quot;PORT=3001 nodemon ./my-node-api/server/server.js\&quot;&quot;
</code></pre>
<p>Le chemin d'accès au script serveur est à adapter en fonction de vos propres
choix techniques ! Notez que dans ce cas précis, on passe une variable
d'environnement <code>PORT</code> que le script serveur utilise pour écraser son port
d'écoute par défaut.</p>
<p>Au final, le <code>package.json</code> doit ressembler à ceci :</p>
<pre><code class="language-json">{
  <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;my-react-frontend&quot;</span>,
  <span class="hljs-attr">&quot;version&quot;</span>: <span class="hljs-string">&quot;0.1.0&quot;</span>,
  <span class="hljs-attr">&quot;private&quot;</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">&quot;proxy&quot;</span>: <span class="hljs-string">&quot;http://localhost:3001&quot;</span>,
  <span class="hljs-attr">&quot;scripts&quot;</span>: {
    <span class="hljs-attr">&quot;start&quot;</span>: <span class="hljs-string">&quot;react-scripts start&quot;</span>,
    <span class="hljs-attr">&quot;start-with-api&quot;</span>:
      <span class="hljs-string">&quot;concurrently \&quot;react-scripts start\&quot; \&quot;PORT=3001 nodemon ./my-node-api/server/server.js\&quot;&quot;</span>,
    <span class="hljs-attr">&quot;build&quot;</span>: <span class="hljs-string">&quot;react-scripts build&quot;</span>,
    <span class="hljs-attr">&quot;test&quot;</span>: <span class="hljs-string">&quot;react-scripts test --env=jsdom&quot;</span>,
    <span class="hljs-attr">&quot;eject&quot;</span>: <span class="hljs-string">&quot;react-scripts eject&quot;</span>
  },
  <span class="hljs-attr">&quot;devDependencies&quot;</span>: {
    <span class="hljs-attr">&quot;react-scripts&quot;</span>: <span class="hljs-string">&quot;1.0.14&quot;</span>,
    <span class="hljs-attr">&quot;concurrently&quot;</span>: <span class="hljs-string">&quot;3.5.0&quot;</span>,
    <span class="hljs-attr">&quot;nodemon&quot;</span>: <span class="hljs-string">&quot;1.12.1&quot;</span>
  },
  <span class="hljs-attr">&quot;dependencies&quot;</span>: {
    <span class="hljs-attr">&quot;react&quot;</span>: <span class="hljs-string">&quot;^16.0.0&quot;</span>,
    <span class="hljs-attr">&quot;react-dom&quot;</span>: <span class="hljs-string">&quot;^16.0.0&quot;</span>
  }
}
</code></pre>
<p>Pour mémoire, nous n'avons ajouté que deux lignes : &quot;proxy&quot; et
&quot;scripts/start-with-api&quot;.</p>
<h2>Une astuce pour les pressés</h2>
<p>Si le backend ne joue pas un grand rôle dans votre application ou si -plus
probablement- vous souhaitez démarrer sans attendre que le véritable backend
soit disponible, je vous conseille de tester l'excellent
<a href="https://github.com/typicode/json-server"><code>json-server</code></a>.</p>
<p>Cet élégant package offre la possibilité de créer un fichier JSON avec quelques
données factices (<em>data fixtures</em>) et de les mettre à disposition de votre
application à la façon d'une API RESTful, grâce à un simple
<code>json-server --watch db.json</code>.</p>
<p>Il va sans dire qu'en modifiant légèrement le script <em>start-with-api</em>, vous
disposerez en quelques secondes d'un <em>backend</em> au poil pour votre nouvelle
application.</p>
</div><style data-emotion-rpcss="v01ydp">.rpcss-v01ydp{max-width:640px;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;margin:20px auto;padding:20px;background-color:#fff;border-radius:10px;box-shadow:0 15px 15px -5px rgba(0,0,0,0.2);}@media (prefers-color-scheme:dark){.rpcss-v01ydp{background-color:#222;}}@media (max-width:540px){.rpcss-v01ydp{-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}}</style><div class="rpcss-v01ydp"><style data-emotion-rpcss="ty7r4z">.rpcss-ty7r4z{font-weight:800;}</style><div class="rpcss-ty7r4z">Vous avez aimé cet article?</div><style data-emotion-rpcss="bb4ce3">.rpcss-bb4ce3{width:0px;height:10px;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}</style><div class="rpcss-bb4ce3"></div><style data-emotion-rpcss="1pkr03v">.rpcss-1pkr03v{background-color:#00aced;color:#fff;padding:10px 20px;-webkit-text-decoration:none;text-decoration:none;border-radius:5px;font-weight:800;}.rpcss-1pkr03v:active{opacity:0.5;}</style><a class="rpcss-1pkr03v" href="https://www.twitter.com/intent/tweet?text=D%C3%A9velopper%20avec%20Create%20React%20App%20et%20une%20API%20Node.js%20sur%20%40PutainDeCode%20https%3A%2F%2Fputaindecode.io%2Farticles%2Fdevelopper-avec-create-react-app-et-une-api-nodejs" target="_blank">Le partager sur Twitter</a></div><style data-emotion-rpcss="x4iqxe">.rpcss-x4iqxe{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;text-align:center;padding:20px;}</style><div class="rpcss-x4iqxe"><style data-emotion-rpcss="gein6x">.rpcss-gein6x{font-size:20px;-webkit-text-decoration:none;text-decoration:none;color:#1E49B5;}</style><a class="rpcss-gein6x" href="/articles">← Articles</a></div><style data-emotion-rpcss="8bodgl">.rpcss-8bodgl{max-width:640px;width:100%;margin:0 auto;padding:20px 0;}</style><div class="rpcss-8bodgl" id="disqus_thread"></div></div></div></div><div class="rpcss-qx7dny"><style data-emotion-rpcss="5518eg">.rpcss-5518eg{margin-top:20px;margin-bottom:20px;background-color:#E4EBEE;border-radius:10px;padding:20px;}@media (prefers-color-scheme:dark){.rpcss-5518eg{background-color:#111;}}</style><div class="rpcss-5518eg"><style data-emotion-rpcss="1gz1i1h">.rpcss-1gz1i1h{font-size:32px;font-weight:800;margin-bottom:20px;text-align:center;}</style><div aria-level="2" class="rpcss-1gz1i1h" role="heading">Ne rien rater</div><style data-emotion-rpcss="1wbispj">.rpcss-1wbispj{font-size:18px;margin-bottom:10px;text-align:center;}</style><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur les réseaux</div><style data-emotion-rpcss="1hyoz7m">.rpcss-1hyoz7m{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div class="rpcss-1hyoz7m"><a href="https://twitter.com/PutainDeCode"><img alt="Twitter" height="48" src="/public/images/website/twitter.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://facebook.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/facebook.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://github.com/putaindecode"><img alt="Facebook" height="48" src="/public/images/website/github.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://itunes.apple.com/fr/podcast/putain-de-code-!/id1185311825"><img alt="Apple Podcast" height="48" src="/public/images/website/apple-podcast.svg" width="48"/></a><div class="rpcss-4cf197"></div><a href="https://soundcloud.com/putaindecode"><img alt="Soundcloud" height="48" src="/public/images/website/soundcloud.svg" width="48"/></a></div><div aria-level="3" class="rpcss-1wbispj" role="heading">Sur le chat</div><div class="rpcss-1hyoz7m"><a href="https://discord.gg/jtbGNNc"><img alt="Discord" height="48" src="/public/images/website/discord.svg" width="48"/></a></div></div></div><style data-emotion-rpcss="zs8kw7">.rpcss-zs8kw7{background-color:#222;padding:20px 0;}</style><footer class="rpcss-zs8kw7"><div class="rpcss-qx7dny"><style data-emotion-rpcss="79elbk">.rpcss-79elbk{position:relative;}</style><div class="rpcss-79elbk"><style data-emotion-rpcss="1hle0ni">.rpcss-1hle0ni{position:absolute;left:0;top:50%;color:#fff;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1hle0ni" href="/api/articles/feeds/desc/feed.xml"><style data-emotion-rpcss="lvyu5j">.rpcss-lvyu5j{margin-right:10px;}</style><img class="rpcss-lvyu5j" alt="Flux RSS" height="16" src="/public/images/website/rss-feed.svg" width="16"/><style data-emotion-rpcss="um3i31">@media (max-width:400px){.rpcss-um3i31{display:none;}}</style><div class="rpcss-um3i31">Flux RSS</div></a><style data-emotion-rpcss="12cp4l7">.rpcss-12cp4l7{color:rgba(255,255,255,0.5);text-align:center;font-size:14px;}</style><div class="rpcss-12cp4l7">© 2020 Putain de code !</div><style data-emotion-rpcss="1y2rkzl">.rpcss-1y2rkzl{position:absolute;right:0;top:50%;-webkit-transform:translateY(-50%);-ms-transform:translateY(-50%);transform:translateY(-50%);color:#fff;-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><a class="rpcss-1y2rkzl" href="https://github.com/putaindecode/putaindecode.io">GitHub</a></div></div></footer></div><script id="initialData" type="text/data">{"lists":{"RE_PRIVATE_NONE":true},"items":{"k":"articles","v":{"k":"developper-avec-create-react-app-et-une-api-nodejs","v":{"_0":{"TAG":0,"_0":{"slug":"developper-avec-create-react-app-et-une-api-nodejs","filename":"2017-11-07-developper-avec-create-react-app-et-une-api-nodejs","title":"Développer avec Create React App et une API Node.js","date":"Tue, 07 Nov 2017 00:00:00 GMT","draft":false,"meta":{"date":"2017-11-07T00:00:00.000Z","title":"Développer avec Create React App et une API Node.js","author":"tmaziere","oldSlug":"js/react/create-react-app-et-api","slug":"developper-avec-create-react-app-et-une-api-nodejs"},"body":"<h2>tl;dr</h2>\n<p>Dans un environnement de développement, pour lancer dans le même temps votre\napplication React et une API basée sur Node.js, vous pouvez imbriquer\njudicieusement les deux dépôts Git, puis utiliser un script NPM et quelques\npackages bien pratiques tels que <em>concurrently</em> et <em>nodemon</em> pour lancer les\ndeux serveurs d'une seule commande. Pratique ! D'autant que pour contourner les\nrestrictions d'accès liées à la\n<a href=\"https://fr.wikipedia.org/wiki/Same-origin_policy\"><em>politique de même origine</em></a>,\n<strong>create-react-app</strong> permet le paramétrage d'un <em>proxy</em> pour vos requêtes API.</p>\n<h2>Est-ce que ça me concerne ?</h2>\n<p>La généralisation des architectures dites &quot;API first&quot; répond à des impératifs\nhumains et techniques très divers. En ce qui concerne l'organisation du travail\ndes développeurs, c'est l'assurance de pouvoir scinder l'implémentation de\nl'accès aux données -aux ressources- d'une part, et le travail sur l'UI/UX,\nd'autre part. Un premier groupe peut concevoir une API robuste et proposer un\n&quot;contrat&quot; clair à l'équipe <em>frontend</em> qui accède aux données avec un référentiel\nunique, que l'application soit web ou mobile.</p>\n<p>De cette façon, la conception de l'interface utilisateur est libérée d'une\ngrande partie des contraintes qui régissent les architectures MVC\ntraditionnelles. Le développeur peut ainsi mieux se concentrer sur la qualité de\nsa réponse aux spécifications fonctionnelles.</p>\n<p>Si l'architecture de votre projet est de ce type, et que vous attaquez la\nconception d'un frontend\n<a href=\"https://fr.wikipedia.org/wiki/Application_web_monopage\">SPA</a> React avec\n<a href=\"https://github.com/facebookincubator/create-react-app\">create-react-app</a>\n(quelle bonne idée !), ce qui suit peut vous éclairer. Nous allons voir comment\nil est possible d'accéder sans se compliquer la vie à une API RESTful basée sur\nNode.js, en imbriquant correctement ses dépôts.</p>\n<h2>Deux dépôts : le frontend, l’API</h2>\n<p>Le principe est le suivant : vous ne souhaitez pas forcément modifier l'API qui\nest implémentée par une autre équipe, ou par un collègue, mais vous devez y\naccéder facilement depuis votre application React.</p>\n<p>Vous allez pour cela devoir travailler sur deux dépôts Git clonés : celui du\n<em>frontend</em> React contiendra par exemple celui de l'API, et un <em>script NPM</em> se\nchargera de lancer les deux applications, sur deux ports différents.</p>\n<p><em>Faut-il utiliser un framework en particulier pour le backend ?</em>  <br />\nAbsolument pas ! Pour ma part je travaille plus volontiers avec <a href=\"https://loopback.io/\">LoopBack</a>,\nmais tout ce que qui s'appuie sur Node.js fait l'affaire.</p>\n<h2>Organisation locale du code</h2>\n<p>Mettons que votre projet React s'appelle <strong>my-react-frontend</strong> et que l'API\nqu'il consomme répond au doux nom de <strong>my-node-api</strong>.</p>\n<p><strong>my-react-frontend</strong> est cloné à la racine, c'est le projet parent. Il contient\nau moins les répertoires <code>src/</code>, <code>public/</code> et <code>node_modules/</code> générés par\n<em>create-react-app</em>.</p>\n<p><code>build/</code> peut également être présent si vous avez déjà lancé au moins une fois\nla commande <code>npm run build</code>.</p>\n<p>A la racine de <strong>my-react-frontend</strong>, clonez le dépôt <strong>my-node-api</strong>.</p>\n<p>Vous devez obtenir :</p>\n<pre><code>my-react-frontend/\n-- my-node-api/\n-- node_modules/\n-- public/\n-- src/\n...\n</code></pre>\n<p>Ne nous attardons pas trop sur <code>my-node-api</code>, qui peut être implémenté de très\nnombreuses manières. Partons du principe qu'une fois lancé, le serveur expose\nles ressources dont votre application a besoin sur <code>http://localhost:3001</code>. Et\ndisons juste que si l'équipe <em>backend</em> vous signale une mise à jour, vous ferez\nsimplement :</p>\n<pre><code class=\"language-Shell\">cd my-node-api/\ngit pull\n</code></pre>\n<p><em>Faut-il forcément organiser les dépôts de cette façon ?</em>  <br />\nPas du tout. Mais l'intérêt de cette configuration, c'est que le <em>backend</em> est &quot;dans\nsa bulle&quot; et que les développeurs qui le font évoluer n'ont pas à organiser le code\nen fonction de ce <em>frontend</em> en particulier.</p>\n<p>Dernière chose importante : pensez à ajouter <code>my-node-api/</code> au fichier\n<code>.gitignore</code> du projet React. Il ne faudrait évidemment pas qu'il versionne le\n<em>backend</em>.</p>\n<h2>Passez moi sur le CORS</h2>\n<p>En production, il est fréquent d'utiliser le même serveur pour servir\nl'application React et l'API sous-jacente. Dans cette configuration, le\nmécanisme de <em>Cross-origin resource sharing</em>\n(<a href=\"https://en.wikipedia.org/wiki/Cross-origin_resource_sharing\">CORS</a>), basé sur\ndes headers HTTP, n'a pas à être implémenté.</p>\n<p>En développement, par contre, il est plus pratique de dissocier les serveurs\npour bénéficier de toutes les fonctionnalités de l'écosystème React.</p>\n<p>Pour répondre à cette contrainte, <em>create-react-app</em> propose\n<a href=\"https://github.com/facebookincubator/create-react-app/blob/master/packages/react-scripts/template/README.md#proxying-api-requests-in-development\">un mécanisme</a>\nqui permet de mettre en place un <strong>proxy</strong> d'API.</p>\n<p>En partant du principe que votre frontend écoute sur le port 3000, et le serveur\nAPI sur le port 3001, il suffit d'ajouter un paramètre au premier niveau du\n<code>package.json</code> :</p>\n<pre><code class=\"language-json\">{\n  <span class=\"hljs-attr\">&quot;proxy&quot;</span>: <span class=\"hljs-string\">&quot;http://localhost:3001&quot;</span>\n}\n</code></pre>\n<p>De cette façon, vous pourrez utiliser un chemin relatif pour accéder à vos\nressources. Si une requête ne concerne pas un <em>asset</em> statique, elle sera\nrelayée vers votre <em>backend</em>. <code>fetch('/api/bananas')</code>, par exemple, requêtera\nnotre API sur <code>http://localhost:3001/api/bananas</code>.</p>\n<h2>Tout lancer en une seule commande</h2>\n<p>Nous utiliserons pour cela un script NPM défini dans le <code>package.json</code> situé à\nla racine du projet React.</p>\n<p>Deux petits outils seront nécessaires pour créer le script <em>ad hoc</em> :</p>\n<ul>\n<li>le package <a href=\"https://www.npmjs.com/package/concurrently\"><code>concurrently</code></a> qui\npermet de lancer plusieurs scripts en une seule commande. Faites par exemple\nun <code>npm install --save-dev concurrently</code>.</li>\n<li>le package <a href=\"https://www.npmjs.com/package/nodemon\"><code>nodemon</code></a> qui scrute votre\n<em>backend</em> Node.js et relance le serveur automatiquement en cas de modification\ndu code. Faites donc un <code>npm install --save-dev nodemon</code>, vous ne le\nregretterez pas.</li>\n</ul>\n<p>Tout est prêt ! Ouvrez <code>package.json</code> et ajoutez dans les <code>scripts</code>:</p>\n<pre><code class=\"language-json\">&quot;start-with-api&quot;: &quot;concurrently \\&quot;react-scripts start\\&quot; \\&quot;PORT=3001 nodemon ./my-node-api/server/server.js\\&quot;&quot;\n</code></pre>\n<p>Le chemin d'accès au script serveur est à adapter en fonction de vos propres\nchoix techniques ! Notez que dans ce cas précis, on passe une variable\nd'environnement <code>PORT</code> que le script serveur utilise pour écraser son port\nd'écoute par défaut.</p>\n<p>Au final, le <code>package.json</code> doit ressembler à ceci :</p>\n<pre><code class=\"language-json\">{\n  <span class=\"hljs-attr\">&quot;name&quot;</span>: <span class=\"hljs-string\">&quot;my-react-frontend&quot;</span>,\n  <span class=\"hljs-attr\">&quot;version&quot;</span>: <span class=\"hljs-string\">&quot;0.1.0&quot;</span>,\n  <span class=\"hljs-attr\">&quot;private&quot;</span>: <span class=\"hljs-literal\">true</span>,\n  <span class=\"hljs-attr\">&quot;proxy&quot;</span>: <span class=\"hljs-string\">&quot;http://localhost:3001&quot;</span>,\n  <span class=\"hljs-attr\">&quot;scripts&quot;</span>: {\n    <span class=\"hljs-attr\">&quot;start&quot;</span>: <span class=\"hljs-string\">&quot;react-scripts start&quot;</span>,\n    <span class=\"hljs-attr\">&quot;start-with-api&quot;</span>:\n      <span class=\"hljs-string\">&quot;concurrently \\&quot;react-scripts start\\&quot; \\&quot;PORT=3001 nodemon ./my-node-api/server/server.js\\&quot;&quot;</span>,\n    <span class=\"hljs-attr\">&quot;build&quot;</span>: <span class=\"hljs-string\">&quot;react-scripts build&quot;</span>,\n    <span class=\"hljs-attr\">&quot;test&quot;</span>: <span class=\"hljs-string\">&quot;react-scripts test --env=jsdom&quot;</span>,\n    <span class=\"hljs-attr\">&quot;eject&quot;</span>: <span class=\"hljs-string\">&quot;react-scripts eject&quot;</span>\n  },\n  <span class=\"hljs-attr\">&quot;devDependencies&quot;</span>: {\n    <span class=\"hljs-attr\">&quot;react-scripts&quot;</span>: <span class=\"hljs-string\">&quot;1.0.14&quot;</span>,\n    <span class=\"hljs-attr\">&quot;concurrently&quot;</span>: <span class=\"hljs-string\">&quot;3.5.0&quot;</span>,\n    <span class=\"hljs-attr\">&quot;nodemon&quot;</span>: <span class=\"hljs-string\">&quot;1.12.1&quot;</span>\n  },\n  <span class=\"hljs-attr\">&quot;dependencies&quot;</span>: {\n    <span class=\"hljs-attr\">&quot;react&quot;</span>: <span class=\"hljs-string\">&quot;^16.0.0&quot;</span>,\n    <span class=\"hljs-attr\">&quot;react-dom&quot;</span>: <span class=\"hljs-string\">&quot;^16.0.0&quot;</span>\n  }\n}\n</code></pre>\n<p>Pour mémoire, nous n'avons ajouté que deux lignes : &quot;proxy&quot; et\n&quot;scripts/start-with-api&quot;.</p>\n<h2>Une astuce pour les pressés</h2>\n<p>Si le backend ne joue pas un grand rôle dans votre application ou si -plus\nprobablement- vous souhaitez démarrer sans attendre que le véritable backend\nsoit disponible, je vous conseille de tester l'excellent\n<a href=\"https://github.com/typicode/json-server\"><code>json-server</code></a>.</p>\n<p>Cet élégant package offre la possibilité de créer un fichier JSON avec quelques\ndonnées factices (<em>data fixtures</em>) et de les mettre à disposition de votre\napplication à la façon d'une API RESTful, grâce à un simple\n<code>json-server --watch db.json</code>.</p>\n<p>Il va sans dire qu'en modifiant légèrement le script <em>start-with-api</em>, vous\ndisposerez en quelques secondes d'un <em>backend</em> au poil pour votre nouvelle\napplication.</p>\n"}}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"h":1,"l":{"RE_PRIVATE_NONE":true},"r":{"RE_PRIVATE_NONE":true}},"listsRequests":{"data":{"RE_PRIVATE_NONE":true}},"itemsRequests":{"data":{"RE_PRIVATE_NONE":true}}}</script><script defer="defer" src="/public/main.2f3054aa098d88f85075.js"></script></html>